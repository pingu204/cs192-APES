{% extends 'base.html' %}

{% block nav %}

    {% include 'nav_main.html' %}

{% endblock %}

{% block content %}

{% load static %}
<div id="cover"></div>

<div class="body-container homepage sched-viewer">
    <div class="main two-column">

    <div class="sched-container">
        <!-- Container for the timetable -->
        <div class="timetable">
            <table id="timetable">
                {{ main_table | safe }}
            </table>
        </div>
    </div>

    <!-- Container for the right panel -->
    <div class="course-list-container">
        <div class="user-header">
            <!-- Schedule Identifier -->
            <h2 class="margin-right-sm"><span>Sched {{ sched_id|add:1 }}</span></h2>

            {% if show_save_button %}
                <form method="POST">
                    {% csrf_token %}
                    <button class="btn-sm margin-right-xs" name="click_saved_sched">SAVE</button>
                </form>
            {% elif show_unsave_button %}
                <form method="POST">
                    {% csrf_token %}
                    <button class="btn-sm margin-right-xs" name="click_unsaved_sched">UNSAVE</button>
                </form>
            {% endif %}

            <!-- Export Button -->
            <button class="btn-sm" data-bs-toggle="modal" data-bs-target="#staticBackdrop" id="export">EXPORT</button>
            
            <div class="filler"></div>

            <!-- Redirect to Home -->
            <span class="bold-text"><a href="../../"><i class="bi bi-caret-left-fill"></i> Back to Schedules</a></span>
        </div>

        <!-- Container for the details of the schedule -->
        <div class="tabs-container margin-top-md margin-bottom-md">
            <div><span class="tab bold-text"><i class="bi bi-person-walking color-icon"></i>0 kilometers/day</span></div>
            <div><span class="tab bold-text"><i class="bi bi-dice-2-fill color-icon"></i>0% chance of being granted</span></div>
            <div><span class="tab bold-text"><i class="bi bi-cup-hot-fill color-icon"></i>0-min. to 0-hour breaks</span></div>
            <div><span class="tab bold-text"><i class="bi bi-calendar-week-fill color-icon"></i>0 to 0 classes/day</span></div>
            <div><span class="tab bold-text"><i class="bi bi-brightness-high-fill color-icon"></i>As early as 00:00 AM</span></div>
            <div><span class="tab bold-text"><i class="bi bi-moon-fill color-icon"></i>As late as 00:00 PM</span></div>
        </div>

        <!-- Container for the header -->
        <div class="course-list-header">
            <h1 style="font-size:16pt;">Classes & Sections</h1>
            <div class="filler"></div>
            <h5 style="font-size:12pt; margin:0"><span class="bold-text light-text">{{ units }}</span></h5>
            <button class="btn-sm"><a href="add/">+</a></button>
        </div>

        <!-- Container for the course cards -->
        <div class="flex-grow-container margin-top-md">

            <!-- Course cards -->
             {% for course in courses %}
            <div class="course-card view-card">
                <div class="course-header">
                    <h6><span class="bold-text"><span id="i-{{ forloop.counter }}"><i class="bi bi-circle-fill color-icon"></i></span>
                    {{ course.course_code }} {{ course.section_name.lec }}{% if course.section_name.lab %}/{{ course.section_name.lab }}{% endif %}</span></h6>
                    <div class="filler"></div>
                    <span class="tab tab-sm bold-text">0% chance of being granted</span>
                </div>
                <div class="details-container margin-top-md">
                    
                    <!-- Instructor/s -->
                    <div class="d-flex flex-row align-items start">
                        <i class="bi bi-person color-icon"></i>
                        <div class="d-flex flex-column justify-content-left">
                            <!-- Only choose either lec or disc prof -->
                            {% if course.instructor_name.lec %}
                                <span>{{ course.instructor_name.lec }}</span>
                            {% elif course.instructor_name.disc %}
                                <span>{{ course.instructor_name.disc }}</span>
                            {% endif %}

                            <!-- Additional prof for lab, if applicable -->
                            {% if course.instructor_name.lab %} 
                                <span>{{ course.instructor_name.lab }} <span class="tab tab-lab bold-text">LAB</span></span>
                            {% endif %}
                            
                        </div>
                    </div>
                    
                    <!-- Units -->
                    <div class="d-flex flex-row align-items start">
                        <i class="bi bi bi-book color-icon"></i>
                        <div class="d-flex flex-column justify-content-left">
                            {{ course.units }} units
                        </div>
                    </div>
                    
                    <!-- Capacity -->
                    <div class="d-flex flex-row align-items start">
                        <i class="bi bi bi-door-closed color-icon"></i>
                        <div class="d-flex flex-column justify-content-left">
                            {{ course.capacity }} students max.
                        </div>
                    </div>

                    <!-- Offering Unit -->
                    <div class="d-flex flex-row align-items start">
                        <i class="bi bi bi-mortarboard color-icon"></i>
                        <div class="d-flex flex-column justify-content-left">
                            {{ course.offering_unit }}
                        </div>
                    </div>

                </div>
                <div class="d-flex margin-top-md">
                    <div class="filler"></div>
                    <button class="btn-sm" disabled>REMOVE</button>
                    <a href="{% url 'redraw_course_to_sched' sched_id=sched_id course_code=course.course_code %}" class="btn-sm margin-left-sm">REDRAW</a>
                </div>
            </div>
            {% endfor %}
        </div>
        <div></div>
    </div>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">

            <!-- Container of the image -->
            <div class="modal-body" id="export-container">
            </div>
            <div class="modal-footer">
            
            <!-- Close Button -->
            <button type="button" class="btn-outline" data-bs-dismiss="modal">Close</button>

            <!-- Download Button -->
            <!-- "click" the hyperlink when pressed -->
            <button id="download-btn" type="button" class="btn btn-primary" onclick="document.getElementById('download-btn').children[0].click();">Download</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Where the image is initially created -->
    <div id="export-sched">
    <div class="contents padding-md">
        <div class="sched-container">
            <!-- Container for the timetable -->
            <div class="timetable export">
                <table id="exportTimetable">
                    {{ export_table | safe }}
                </table>
            </div>
        </div>
        <div class="padding-md padding-left-lg padding-right-lg">

            <!-- Container for the header -->
            <div class="course-list-header margin-top-lg margin-bottom-md">
                <h1>Classes & Sections</h1>
                <div class="filler"></div>
                <h5><span class="bold-text light-text">{{units}}</span></h5>
            </div>

            <!-- Included classes in the schedule -->
            {% for course in courses %}
            <div class="course-header">
                <h6><span class="bold-text"><span id="i-{{forloop.counter}}"><i class="bi bi-circle-fill color-icon"></i></span>{{ course.course_code }} {{ course.section_name.lec }}{% if course.section_name.lab %}/{{ course.section_name.lab }}{% endif %}</span></h6>
                <div class="filler"></div>
                <span class="tab tab-sm bold-text">{{ course.units }} units</span>
            </div>
            {% endfor %}
        </div>
        <div class="filler"></div>
        <!-- <div class="d-flex flex-column justify-content-center">
            <span class="bold-text">Generated using </span><img class="apes-logo" src="{% static 'images/apes_logo.png' %}">
        </div> -->
    </div>
    </div>
</div>

{% endblock %}

{% block footer %}

    {% include 'footer.html' %}

{% endblock %}


{% block addtl_scripts %}

<script  type="module" type="text/javascript" src="{% static 'js/view.js' %}"></script>
<script type="module" type="text/javascript" src="{% static 'js/html2canvas.js' %}" ></script>

{% endblock %}